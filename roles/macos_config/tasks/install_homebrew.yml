---

- name: '[homebrew] Prepare necessary directories for Homebrew'
  file:
    path: /usr/local/sbin # NOTE: can fail - run `sudo mkdir -p /usr/local/sbin` instead
    owner: "{{ macos_config.home_user }}" # NOTE: chonw -R $(whoami) /usr/local/sbin
    state: directory
    recurse: yes

- name: '[homebrew] Check Homebrew installation status'
  stat:
    path: /usr/local/bin/brew
  register: macos_homebrew_status

- name: '[homebrew] Check and Install homebrew'
  vars: { macos_homebrew_url: https://raw.githubusercontent.com/Homebrew/install/master/install }
  block:
    - stat:
        path: /usr/local/bin/brew
      register: macos_homebrew_status
    - command: /usr/bin/ruby -e "$(curl -fsSL {{ macos_homebrew_url }})"
      when: not macos_homebrew_status.stat.exists

- name: '[homebrew] Update homebrew to the latest version'
  homebrew:
    update_homebrew: yes
